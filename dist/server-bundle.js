!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("matter-js")},function(e,t){e.exports=require("rxjs/operators")},function(e,t){e.exports=require("rxjs")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("cors")},function(e,t,r){"use strict";r.r(t);var n,o=process.env.PORT||5e3,i="http://localhost:"+o,a=1e3/30,c=800,l=800,u=60,d=60,s=5,f=r(0),y=r(2),b=r(1),g=function(){return(g=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},h=r(0),p=5,v=20,j=5,x=10,O=["#fea49f","#51d0de","#bf4aa8","#F7882F","#F7C331","#1561ad","#1dbab4","#fc5226","#eb1736","#8bf0ba"],w={},m={},S={},k={},M={},P={},B={},q=h.Engine,A=h.World,F=h.Bodies,_=h.Events,R=q.create();R.world.gravity.y=0;var T=F.rectangle(0,0,2*c,1,{isStatic:!0}),D=F.rectangle(0,0,1,2*l,{isStatic:!0}),E=F.rectangle(c,0,1,2*l,{isStatic:!0}),L=F.rectangle(0,l,2*c,1,{isStatic:!0});function C(){return n||(n=Object(y.interval)(a).pipe(Object(b.filter)((function(){return Object.keys(w).length>0})),Object(b.map)((function(){return function(){for(var e=0,t=Object.keys(S);e<t.length;e++){var r=t[e],n=S[r],o=w[r],i=m[r],c=o.x,l=o.y,u=o.angle;n.left&&(c-=p),n.up&&(l-=p),n.right&&(c+=p),n.down&&(l+=p),n.arrowLeft&&(u-=j),n.arrowRight&&(u+=j),o.angle=u,n.fire&&o.lastFire+1e3<Date.now()&&G(o),f.Body.setPosition(i,{x:c,y:l})}if(Object.keys(M).length<x)for(var d=0;d<x-Object.keys(M).length;d++)z();for(var s=0,y=Object.keys(k);s<y.length;s++){r=y[s];var b=k[r],g=(c=b.x,l=b.y,b.angle),h=P[r];c+=v*Math.cos(W(g)),l+=v*Math.sin(W(g)),f.Body.setPosition(h,{x:c,y:l})}q.update(R,a),_.on(R,"collisionStart",(function(e){var t,r,n=e.pairs.length;for(t=0;t<n;t++)r=e.pairs[t],Object.keys(P).includes(r.bodyA.id.toString())&&(H(r.bodyA.id),Object.keys(m).includes(r.bodyB.id.toString())&&(1===w[r.bodyB.id].health?I(r.bodyB.id):w[r.bodyB.id].health-=1)),Object.keys(P).includes(r.bodyB.id.toString())&&(H(r.bodyB.id),Object.keys(m).includes(r.bodyA.id.toString())&&(1===w[r.bodyA.id].health?I(r.bodyA.id):w[r.bodyA.id].health-=1))}));for(var O=0,A=Object.keys(m);O<A.length;O++){r=A[O];var F=m[r].position;c=F.x,l=F.y;w[r].x=c,w[r].y=l}for(var T=0,D=Object.keys(B);T<D.length;T++){r=D[T];var E=B[r].position;c=E.x,l=E.y;M[r].x=c,M[r].y=l}for(var L=0,C=Object.keys(P);L<C.length;L++){r=C[L];var J=P[r].position;c=J.x,l=J.y;k[r].x=c,k[r].y=l}return{players:w,bullets:k,walls:M}}()})),Object(b.share)()))}function I(e){m[e]&&A.remove(R.world,m[e]),delete w[e],delete S[e],delete m[e]}function W(e){return e*Math.PI/180}function z(){var e=K(40,100),t=K(40,100),r=J(e,t),n=r.x,o=r.y,i=K(0,1e6);M[i]={x:n,y:o,width:e,height:t};var a=F.rectangle(n,o,e,t,{id:i});B[i]=a,A.add(R.world,[a])}function G(e){var t=e.x+u/2*Math.cos(W(e.angle)),r=e.y+d/2*Math.sin(W(e.angle)),n=K(0,1e6);k[n]={id:n,angle:e.angle,x:t,y:r};var o=F.circle(t,r,s,{id:n});P[n]=o,A.add(R.world,[o]),e.lastFire=Date.now()}function H(e){P[e]&&A.remove(R.world,P[e]),delete k[e],delete P[e]}function J(e,t){return{x:K(e,c-e),y:K(t,l-t)}}function K(e,t){return Math.floor(Math.random()*(1+t-e))+e}function N(){var e,t=O.filter((function(e){for(var t=0,r=Object.keys(w);t<r.length;t++){var n=r[t];if(w[n].color===e)return!1}return!0}));0===t.length&&(t=O);for(var r=0;r<t.length;r++)e=t[Math.floor(Math.random()*t.length)];return e}A.add(R.world,[T,D,E,L]);var Q=r(3)(),U=r(4).createServer(Q),V=r(5)(U),X=r(6);Q.use(X()),Q.get("/",(function(e,t){t.send("<h1>Server</h1>")})),V.on("connection",(function(e){e.on("join",(function(t){(function(e,t){w[t]=g(g({},J(u,d)),{color:N(),name:e,angle:0,lastFire:0,health:3}),S[t]={up:!1,down:!1,left:!1,right:!1,arrowLeft:!1,arrowRight:!1,fire:!1};var r=F.rectangle(w[t].x,w[t].y,u,d,{id:t});return A.add(R.world,[r]),m[t]=r,w[t]})(t,e.id)&&(V.to(""+e.id).emit("joined",!0),C().subscribe((function(t){return e.emit("state",t)})))})),e.on("movement",(function(t){var r,n;r=e.id,n=t,w[r]&&(S[r]=n)})),e.on("disconnect",(function(){I(e.id)}))})),U.listen(o,(function(){console.log("listening on "+i)}))}]);